# Coffee Shop Backend

## Getting Started

### Installing Dependencies

#### Python 3.7

Follow instructions to install the latest version of python for your platform in the [python docs](https://docs.python.org/3/using/unix.html#getting-and-installing-the-latest-version-of-python)

#### Virtual Environment

We recommend working within a virtual environment whenever using Python for projects. This keeps your dependencies for each project separate and organized. Instructions for setting up a virtual environment for your platform can be found in the [python docs](https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/)

#### PIP Dependencies

Once you have your virtual environment setup and running, install dependencies by naviging to the `/backend` directory and running:

```bash
pip install -r requirements.txt
```

This will install all of the required packages we selected within the `requirements.txt` file.

##### Key Dependencies

- [Flask](http://flask.pocoo.org/) is a lightweight backend microservices framework. Flask is required to handle requests and responses.

- [SQLAlchemy](https://www.sqlalchemy.org/) and [Flask-SQLAlchemy](https://flask-sqlalchemy.palletsprojects.com/en/2.x/) are libraries to handle the lightweight sqlite database. Since we want you to focus on auth, we handle the heavy lift for you in `./src/database/models.py`. We recommend skimming this code first so you know how to interface with the Drink model.

- [jose](https://python-jose.readthedocs.io/en/latest/) JavaScript Object Signing and Encryption for JWTs. Useful for encoding, decoding, and verifying JWTS.

## Running the server

From within the `./src` directory first ensure you are working using your created virtual environment.

Each time you open a new terminal session, run:

```bash
export FLASK_APP=api.py;
```

To run the server, execute:

```bash
flask run --reload
```

The `--reload` flag will detect file changes and restart the server automatically.

## ðŸ“– API Reference

### Getting Started

- **Base URL**: At present this app can only be run locally and is not hosted as a base URL. The backend app is hosted at the default, http://127.0.0.1:5000/, which is set as a proxy in the frontend configuration.

- **Authentication**: Some endpoints need a JWT token generated by the Auth0 after user's login.
- **Permission**: Some endpoints need a specific permission (see bellow for more detail).

### Error Handling

Errors are returned as JSON objects in the following format:
```json
{
    "success": false, 
    "error": 400,
    "message": "bad request",
}
```

The API will return three error types when requests fail:

- 400: Bad Request
- 404: Resource Not Found
- 422: Not Processable
- 500: Internal Server Error 

### â˜• Drinks endpoints

#### GET ` /drinks `

    Get all the drinks.
    
    auth:
        public method.
    retun:
        - if success:
            - status code 200
            - json {"success": True, "drinks": drinks}
                drinks is a list of short description of a drink
        -if fail:
            - status code 422
            
#### GET ` /drinks-detail `
 
    Get all the drinks detail.

    auth:
        require the 'get:drinks-detail' permission
    retun:
        - if success:
            - status code 200
            - json {"success": True, "drinks": drinks}
                drinks is a list of detailled description of a drink

#### POST ` /drinks `

    Creates a new drink.

    auth:
        requires the 'post:drinks' permission
    retun:
        - if success:
            - status code 200
            - json {"success": True, "drinks": drinks}
                drink an array containing only the newly created drink
                with drink.long() data representation
                
#### PATCH ` /drinks/<int:id> `

    Updates an existing drink base on the id.

    auth:
        requires the 'patch:drinks' permission
    retun:
        - if success:
            - status code 200
            - json {"success": True, "drinks": drinks}
                drink an array containing only the newly updated drink
                with drink.long() data representation
        - 404 if id not found
        
#### DELETE ` /drinks/<int:id> `

    Deletes an existing drink based on the id.

    auth:
        requires the 'delete:drinks' permission
    retun:
        - if success:
            - status code 200
            - json {"success": True, "delete": id}
                where id is the id of the deleted record
        - 404 if id not found
        
       
### ðŸ¤“ Users endpoints

#### GET ` /users `

    Retrieve details of users.

    auth:
        require the 'read:users' permission
    retun:
        - if success:
            - status code 200
            - json {"success": True, "users": data}
                users is a list of detailled description of users
                
#### GET ` /users/<str:id>/roles `

    List the the roles associated with a user

    auth:
        require the 'read:role' permission
    params:
        id: a user's id.
    retun:
        - if success:
            - status code 200
            - json {"success": True, "roles": data}
                roles (a list) of a given user identified by id.
                
#### GET ` /users/<str:id>/organizations `

    Retrieve all organizations that the specified user is a member of.

    auth:
        require the 'read:organizations' permission
    params:
        id: a user's id.
    retun:
        - if success:
            - status code 200
            - json {"success": True, "organizations": data}
                organizations that a given user is a member of.
                
#### GET ` /users/<str:id>/logs `

    Retrieve log events for a specific user.

    auth:
        require the 'read:logs_users' permission
    params:
        id: a user's id.
    retun:
        - if success:
            - status code 200
            - json {"success": True, "logs": data}
                a given user's logs events.
